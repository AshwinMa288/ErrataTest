---
title: "[MS-WINERRATA]: Server Message Block (SMB) Protocol Versions 2 and 3"
description: "This topic lists the Errata found in [MS-SMB2]    since it was last published. Since this topic is updated frequently, we    recommend that you"
---

# [MS-SMB2]: Server Message Block (SMB) Protocol Versions 2 and 3

<p align="right"><a href="https://msdn.microsoft.com/en-us/library/2cdafcfa-ce51-426a-9678-630a505a1a35">msdn link</a></p>
<p> </p>

<table>
 <thead>
  <tr>
   <th>
   <p>This topic lists the Errata found in [MS-SMB2]
   since it was last published. Since this topic is updated frequently, we
   recommend that you subscribe to these RSS or Atom feeds to receive update
   notifications.</p>
   <p>Errata are subject to the same terms as the
   Open Specifications documentation referenced.</p>
   </th>
   <th>
   <p><img id="Picture 19" src="MS-WINERRATA_files/image001.png"><span><a href="http://blogs.msdn.com/b/protocol_content_errata/rss.aspx">RSS</a></span>
   </p>
   <p><img id="Picture 20" src="MS-WINERRATA_files/image001.png"><span><a href="http://blogs.msdn.com/b/protocol_content_errata/atom.aspx">Atom</a></span>
   </p>
   <p> </p>
   </th>
  </tr>
 </thead>
</table>

<p>To view a PDF file of the errata for the previous versions
of this document, see the following ERRATA Archives:</p>

<p>October 16, 2015 - <span><a href="http://go.microsoft.com/fwlink/?LinkID=690377">Download</a></span></p>

<p>June 30, 2015 - <span><a href="http://go.microsoft.com/fwlink/?LinkId=617579">Download</a></span></p>

<p>July 18, 2016 - <span><a href="http://go.microsoft.com/fwlink/?LinkId=822549">Download</a> </span></p>

<p>September 26, 2016 - <span><a href="http://go.microsoft.com/fwlink/?LinkId=828556">Download</a> </span></p>

<p>March 20, 2017 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-170320.pdf">Download</a></span></p>

<p>June 1, 2017 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-170601.pdf">Download</a></span></p>

<p>September 15, 2017 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-170915.pdf">Download</a></span>
</p>

<p>December 1, 2017 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-171201.pdf">Download</a>
</span></p>

<p>March 16, 2018 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-180316.pdf">Download</a></span>
</p>

<p>September 12, 2018 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-180912.pdf">Download</a></span>
</p>

<p>March 13, 2019 - <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-WINERRATA/%5bMS-WINERRATA%5d-190313.pdf">Download</a></span></p>

<p>Errata below are for Protocol Document Version <span><a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb2/5606ad47-5ee0-437a-817e-70c366052962">V58.0
– 2019/04/30</a></span>.</p>

<table><thead>
  <tr>
   <th>
   <p>Errata Published*</p>
   </th>
   <th>
   <p>Description</p>
   </th>
  </tr>
 </thead><tbody><tr>
  <td>
  <p>2019/08/05</p>
  </td>
  <td>
  <p>In Section 2.2.2.1, SMB2 ERROR Context Response, the
  description of ErrorId has been changed from:</p>
  <p> </p>
  <p>ErrorId (4 bytes): An identifier for the error
  context. This field MUST be set to the following value. </p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>ErrorId (4 bytes): An identifier for the error
  context. This field MUST be set to one of the following values.</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/08/05</p>
  </td>
  <td>
  <p>In Section 3.1.4.4, Compressing the Message, the
  following has been changed from:</p>
  <p> </p>
  <p>The sender MUST perform the following:</p>
  <p>Set Offset to the length, in bytes, if any, of the
  uncompressed part of the message. Otherwise, set Offset to zero.</p>
  <p>Set OriginalCompressedSegmentSize to the uncompressed
  length, in bytes, of the portion of the message that is compressed.</p>
  <p>Assemble the outgoing message as a concatenation of
  the SMB2 COMPRESSION_TRANSFORM_HEADER followed by the uncompressed portion of
  the message followed by the compressed payload.</p>
  <p>The sender MUST compress the data using the
  CompressionAlgorithm as specified in [MS-XCA] section 2.</p>
  <p>If the size of the resulting SMB2 message is less than
  OriginalCompressedSegmentSize, the sender MUST replace the SMB2 message with
  the concatenated SMB2 COMPRESSION_TRANSFORM_HEADER and compressed SMB2
  message.  </p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>The sender MUST perform the following:</p>
  <p>If the entire SMB2 message is being compressed, then
  set Offset to zero; otherwise, set Offset to the length, in bytes, of the
  uncompressed part of the message. </p>
  <p>Set OriginalCompressedSegmentSize to the uncompressed
  length, in bytes, of the portion of the message that is being compressed.</p>
  <p>The sender MUST compress the data using the
  CompressionAlgorithm as specified in [MS-XCA] section 2.</p>
  <p>If the size of the compressed data is less than
  OriginalCompressedSegmentSize, the sender MUST perform the following:</p>
  <p>If Offset is zero, the sender MUST replace the SMB2
  message with the SMB2 COMPRESSION_TRANSFORM_HEADER followed by the compressed
  SMB2 message. Otherwise, the sender MUST replace the portion of the SMB2
  message selected for compression with the compressed part and prepend the
  SMB2 message with the SMB2 COMPRESSION_TRANSFORM_HEADER.</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/08/05</p>
  </td>
  <td>
  <p>In this document, multiple sections have been updated
  to handle multichannel scenarios.</p>
  <p> </p>
  <p>For details on these changes, see the PDF doc <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SMB2/%5bMS-SMB2%5d_190805_errata_diff.pdf">here</a></span>.</p>
  <p> </p>
  </td>
 </tr><tr>
  <td>
  <p>2019/06/24</p>
  </td>
  <td>
  <p>In Section 3.3.5.4, Receiving an SMB2 NEGOTIATE
  Request, information about how the compression algorithms are handled has
  been added.</p>
  <p> </p>
  <p>Changed from:</p>
  <p> </p>
  <p>The server SHOULD &lt;234&gt; set
  Connection.CompressionIds to all the algorithms in the CompressionAlgorithms
  field, in the order they are received. If the server does not support any of
  the algorithms provided by the client, Connection.CompressionIds MUST be set
  to an empty list. </p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>The server SHOULD &lt;234&gt; set
  Connection.CompressionIds to all the supported compression algorithms common
  to both client and server in the CompressionAlgorithms field, in the order
  they are received. If the server does not support any of the algorithms
  provided by the client, Connection.CompressionIds MUST be set to an empty
  list.</p>
  <p> </p>
  <p>In this same section, the following step has been
  removed from the processing rules:</p>
  <p>&#8203;</p>
  <p>&#9679; If CompressionAlgorithm received in the
  request is “NONE”.</p>
  <p> </p>
  </td>
 </tr><tr>
  <td>
  <p>2019/06/10</p>
  </td>
  <td>
  <p>In Section 3.3.5.15, Receiving an SMB2 IOCTL Request,
  we added some clarifying information.</p>
  <p> </p>
  <p>Changed from:</p>
  <p> </p>
  <p>If InputCount is not equal to zero, the server MUST
  fail the request with STATUS_INVALID_PARAMETER in the following cases:</p>
  <p><span>§<span>  
  </span></span>If InputOffset is greater than zero but less than (size of SMB2
  header + size of the SMB2 IOCTL request not including Buffer) or if
  InputOffset is greater than (size of SMB2 header + size of the SMB2 IOCTL
  request).</p>
  <p><span>§<span>  
  </span></span>If OutputOffset is greater than zero but less than (size of
  SMB2 header + size of the SMB2 IOCTL request not including Buffer) or if
  OutputOffset is greater than (size of SMB2 header + size of the SMB2 IOCTL
  request).</p>
  <p><span>§<span>  
  </span></span>If (InputOffset + InputCount) is greater than (size of SMB2
  header + size of the SMB2 IOCTL request).</p>
  <p><span>§<span>  
  </span></span>If (OutputOffset + OutputCount) is greater than (size of SMB2
  header + size of the SMB2 IOCTL request).</p>
  <p><span>§<span>  
  </span></span>If OutputCount is greater than zero and OutputOffset is less
  than (InputOffset + InputCount).</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If InputCount is not equal to zero, the server MUST
  fail the request with STATUS_INVALID_PARAMETER in the following cases:</p>
  <p><span>§<span>  
  </span></span>If InputOffset is greater than zero but less than (size of SMB2
  header + size of the SMB2 IOCTL request not including Buffer).</p>
  <p><span>§<span>  
  </span></span>If InputOffset is not a multiple of 8 bytes.</p>
  <p><span>§<span>  
  </span></span>If InputOffset is greater than size of SMB2 Message. </p>
  <p><span>§<span>  
  </span></span>If (InputOffset + InputCount) is greater than size of SMB2
  Message.</p>
  <p> </p>
  <p>If InputCount is equal to zero and InputOffset is
  greater than size of SMB2 Message, the server MAY&lt;320&gt; fail the request
  with STATUS_INVALID_PARAMETER. The server SHOULD&lt;321&gt; ignore
  OutputOffset and OutputCount fields.</p>
  <p> </p>
  <p>&lt;320&gt; Section 3.3.5.15: Windows 8 and later and
  Windows Server 2012 and later do not fail the request.</p>
  <p> </p>
  <p>&lt;321&gt; Section 3.3.5.15: Windows Vista, Windows
  Server 2008, Windows 7, and Windows Server 2008 R2 fail the request with
  STATUS_INVALID_PARAMETER in the following cases:</p>
  <p><span>§<span>  
  </span></span>If OutputCount is not equal to zero and OutputOffset is greater
  than zero but less than (size of SMB2 header + size of the SMB2 IOCTL request
  not including Buffer).</p>
  <p><span>§<span>  
  </span></span>If OutputCount is not equal to zero and OutputOffset is greater
  than size of SMB2 Message.</p>
  <p><span>§<span>  
  </span></span>If OutputCount is not equal to zero and OutputOffset is not
  rounded up to a multiple of 8 bytes.</p>
  <p><span>§<span>  
  </span></span>If (OutputOffset + OutputCount) is greater than size of SMB2
  Message.</p>
  <p><span>§<span>  
  </span></span>If OutputCount is greater than zero and OutputOffset is less
  than (InputOffset + InputCount). Windows 7 and Windows </p>
  <p> </p>
  <p>Server 2008 R2 fail the request with
  STATUS_INVALID_PARAMETER if OutputOffset or OutputCount is greater than size
  of SMB2 Message.</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/04/29</p>
  </td>
  <td>
  <p>In Section 2.2.3.1, SMB2 NEGOTIATE_CONTEXT Request
  Values, the value of SMB2_COMPRESSION_CAPABILITIES has been changed from:</p>
  <p> </p>
  <p>0x0004</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>0x0003</p>
  <p> </p>
  <p>In Section 6, Appendix A: Product Behavior, the
  following behavior notes have been changed from:</p>
  <p> </p>
  <p>&lt;13&gt; Section 2.2.3.1:  Windows 10 v1809
  operating system and prior, Windows Server v1809 operating system and prior,
  and Windows Server 2019 and prior do not support compression.</p>
  <p>&lt;14&gt; Section 2.2.3.1:  Windows 10 v1809 and
  prior, Windows Server v1809 and prior, and Windows Server 2019 and prior do
  not support SMB2 _NETNAME_NEGOTIATE_CONTEXT_ID.</p>
  <p>&lt;53&gt; Section 2.2.19:  Windows 10 v1809 and prior
  and Windows Server v1809 and prior do not support 
  SMB2_READFLAG_REQUEST_COMPRESSED flag.</p>
  <p>&lt;72&gt; Section 2.2.42:  Windows 10 v1809 and prior
  and Windows Server v1809 and prior do not support compression and  SMB2
  COMPRESSION_TRANSFORM_HEADER.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>&lt;13&gt; Section 2.2.3.1:  Windows 10 v1809
  operating system and prior, Windows Server v1809 operating system and prior,
  and Windows Server 2019 and prior do not send or process
  SMB2_COMPRESSION_CAPABILITIES.</p>
  <p>&lt;14&gt; Section 2.2.3.1:  Windows 10 v1809 and
  prior, Windows Server v1809 and prior, and Windows Server 2019 and prior do
  not send or process SMB2 _NETNAME_NEGOTIATE_CONTEXT_ID.</p>
  <p>&lt;53&gt; Section 2.2.19:  Windows 10 v1809 and prior
  and Windows Server v1809 and prior do not send or process 
  SMB2_READFLAG_REQUEST_COMPRESSED flag.</p>
  <p>&lt;72&gt; Section 2.2.42:  Windows 10 v1809 and prior
  and Windows Server v1809 and prior do not send or process  SMB2
  COMPRESSION_TRANSFORM_HEADER.</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/04/29</p>
  </td>
  <td>
  <p>This document has been updated to add the DataLength
  validation step for the processing of SMB2_ENCRYPTION_CAPABILITIES negotiate
  context.</p>
  <p> </p>
  <p>In Section 3.3.5.2, Receiving Any Message, the
  following has been changed from:</p>
  <p> </p>
  <p>If the Connection.Dialect is &quot;3.1.1&quot;, then
  the server MUST process the negotiate context list that is specified by the
  request's NegotiateContextOffset and NegotiateContextCount fields as follows:</p>
  <p>Processing the SMB2_PREAUTH_INTEGRITY_CAPABILITIES
  negotiate context:</p>
  <p>If the negotiate context list does not contain exactly
  one SMB2_PREAUTH_INTEGRITY_CAPABILITIES negotiate context, then the server
  MUST fail the negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>If the SMB2_PREAUTH_INTEGRITY_CAPABILITIES
  HashAlgorithms array does not contain any hash algorithms that the server
  supports, then the  server MUST fail the negotiate request with
  STATUS_SMB_NO_PREAUTH_INTEGRITY_HASH_OVERLAP (0xC05D0000).</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If the Connection.Dialect is &quot;3.1.1&quot;, then
  the server MUST process the NegotiateContextList that is specified by the
  request's NegotiateContextOffset and NegotiateContextCount fields as follows:</p>
  <p>If the NegotiateContextList contains more than one
  SMB2_PREAUTH_INTEGRITY_CAPABILITIES negotiate context, the server MUST fail
  the negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>If the NegotiateContextList contains more than one
  SMB2_ENCRYPTION_CAPABILITIES negotiate context, the server MUST fail the
  negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>If the NegotiateContextList contains more than one
  SMB2_COMPRESSION_CAPABILITIES negotiate context, the server MUST fail the
  negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>Processing the SMB2_PREAUTH_INTEGRITY_CAPABILITIES
  negotiate context:</p>
  <p>If the DataLength of the negotiate context is less
  than the size of SMB2_PREAUTH_INTEGRITY_CAPABILITIES structure, the server
  MUST fail the negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>If the SMB2_PREAUTH_INTEGRITY_CAPABILITIES
  HashAlgorithms array does not contain any hash algorithms that the server
  supports, the  server MUST fail the negotiate request with
  STATUS_SMB_NO_PREAUTH_INTEGRITY_HASH_OVERLAP (0xC05D0000).</p>
  <p> </p>
  <p>...</p>
  <p> </p>
  <p>Changed from:</p>
  <p> </p>
  <p>If the negotiate context list contains more than one
  SMB2_ENCRYPTION_CAPABILITIES negotiate context, then the server MUST fail the
  negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>The server MUST set Connection.CipherId to one of the
  ciphers in the client's SMB2_ENCRYPTION_CAPABILITIES Ciphers array in an
  implementation-specific manner. If the client and server have no common
  cipher, then the server MUST sets Connection.CipherId to 0.  </p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If the DataLength of the negotiate context is less
  than the size of the SMB2_ENCRYPTION_CAPABILITIES structure, the server MUST
  fail the negotiate request with STATUS_INVALID_PARAMETER.</p>
  <p>The server MUST set Connection.CipherId to one of the
  ciphers in the client's SMB2_ENCRYPTION_CAPABILITIES Ciphers array in an
  implementation-specific manner. If the client and server have no common
  cipher, the server MUST set Connection.CipherId to 0.  </p>
  <p> </p>
  <p>In Section, 3.3.5.4, Receiving an SMB2 NEGOTIATE
  Request, the following has been changed from:</p>
  <p> </p>
  <p>If Connection.Dialect is &quot;3.1.1&quot;, then the
  server MUST build a negotiate context list for its negotiate response as
  follows:</p>
  <p>Building an SMB2_PREAUTH_INTEGRITY_CAPABILITIES
  negotiate context:</p>
  <p>The server MUST add an
  SMB2_PREAUTH_INTEGRITY_CAPABILITIES negotiate context to the response's
  negotiate context list. </p>
  <p>HashAlgorithmCount MUST be set to 1. </p>
  <p>SaltLength MUST be set to an
  implementation-specific&lt;239&gt; number of Salt bytes. </p>
  <p>HashAlgorithms[0] MUST be set to
  Connection.PreauthIntegrityHashId. </p>
  <p>The Salt buffer MUST be filled with SaltLength unique
  bytes that are generated for this response by a cryptographic secure
  pseudo-random number generator. </p>
  <p>Building an SMB2_ENCRYPTION_CAPABILITIES negotiate
  response context:</p>
  <p>If the server received an SMB2_ENCRYPTION_CAPABILITIES
  negotiate context in the client's negotiate request, then the server MUST add
  an SMB2_ENCRYPTION_CAPABILITIES negotiate context to the response's negotiate
  context list. Note that the server MUST send an SMB2_ENCRYPTION_CAPABILITIES
  context even if the client and server have no common cipher. This is done so
  that the client can differentiate between a server that does not support
  encryption (no SMB2_ENCRYPTION_CAPABILITIES context in the response's
  negotiate context list) and a server that supports encryption but does not
  share a cipher with the client (an SMB2_ENCRYPTION_CAPABILITIES context in
  the response's negotiate context list that indicates a cipher of 0). </p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If Connection.Dialect is &quot;3.1.1&quot;, then the
  server MUST build a NegotiateContextList for its negotiate response as
  follows:</p>
  <p>Building an SMB2_PREAUTH_INTEGRITY_CAPABILITIES
  negotiate context:</p>
  <p>The server MUST add an
  SMB2_PREAUTH_INTEGRITY_CAPABILITIES negotiate context to the response's
  NegotiateContextList.</p>
  <p>HashAlgorithmCount MUST be set to 1. </p>
  <p>SaltLength MUST be set to an
  implementation-specific&lt;239&gt; number of Salt bytes. </p>
  <p>HashAlgorithms[0] MUST be set to
  Connection.PreauthIntegrityHashId. </p>
  <p>The Salt buffer MUST be filled with SaltLength unique
  bytes that are generated for this response by a cryptographic secure
  pseudo-random number generator. </p>
  <p>Building an SMB2_ENCRYPTION_CAPABILITIES negotiate
  response context:</p>
  <p>If the server received an SMB2_ENCRYPTION_CAPABILITIES
  negotiate context in the client's negotiate request, the server MUST add an
  SMB2_ENCRYPTION_CAPABILITIES negotiate context to the response's
  NegotiateContextList. Note that the server MUST send an
  SMB2_ENCRYPTION_CAPABILITIES context even if the client and server have no
  common cipher. This is done so that the client can differentiate between a
  server that does not support encryption (no SMB2_ENCRYPTION_CAPABILITIES
  context in the response's NegotiateContextList) and a server that supports
  encryption but does not share a cipher with the client (an
  SMB2_ENCRYPTION_CAPABILITIES context in the response's NegotiateContextList
  that indicates a cipher of 0).</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/04/29</p>
  </td>
  <td>
  <p>This document has been updated to handle the case when
  an invalid ProtocolId is received in the header of the message.</p>
  <p> </p>
  <p>In Section 2.2.1.1, SMB2 Packet Header – ASYNC, the
  following has been changed from:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The value
  MUST be (in network order) 0xFE, 'S', 'M', and 'B'.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be set to 0x424D53FE, also represented as (in network order) 0xFE,
  'S', 'M', and 'B'.</p>
  <p> </p>
  <p>In Section 2.2.1.2, SMB2 Packet Header – SYNC, the
  following has been changed from:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be (in network order) 0xFE, 'S', 'M', and 'B'.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be set to 0x424D53FE, also represented as (in network order) 0xFE,
  'S', 'M', and 'B'.</p>
  <p> </p>
  <p>In Section 2.2.41, SMB2 TRANSFORM_HEADER, the
  following has been changed from:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be (in network order) 0xFD, 'S', 'M', and 'B'.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be set to 0x424D53FD, also represented as (in network order) 0xFD,
  'S', 'M', and 'B'.</p>
  <p> </p>
  <p>In Section 2.2.42, SMB2 COMPRESSION_TRANSFORM_HEADER,
  the following has been changed from:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be (in network order) 0xFC, 'S', 'M', and 'B'.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>ProtocolId (4 bytes): The protocol identifier. The
  value MUST be set to 0x424D53FC, also represented as (in network order) 0xFC,
  'S', 'M', and 'B'.</p>
  <p> </p>
  <p>In Section 3.2.5.1, Receiving Any Message, the
  following has been changed from:</p>
  <p> </p>
  <p>If the server implements the SMB 3.x dialect family
  and ProtocolId in the header of the received message is 0x424d53FD, the
  client MUST decrypt the request as specified in section 3.2.5.1.1 before
  performing the following steps.</p>
  <p>If the server implements the SMB 3.1.1 dialect and
  ProtocolId in the header of the received message is 0x424d53FC, the client
  MUST decompress the request as specified in section 3.2.5.1.10 before
  performing the following steps.</p>
  <p>Unless specifically noted in a subsequent section, the
  following logic MUST be applied to any response message that is received from
  the server by the client. If the status code in the SMB2 header is not equal
  to STATUS_SUCCESS, the client SHOULD&lt;143&gt; retry the operation, in an
  implementation-specific manner, on the same or different channel. The client
  MUST ignore the CreditCharge field in the SMB2 header.</p>
  <p>If the message size received exceeds Connection.MaxTransactSize,
  the client MUST disconnect the connection.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If the client implements the SMB 3.x dialect family
  and ProtocolId in the header of the received message is 0x424D53FD, the
  client MUST decrypt the request as specified in section 3.2.5.1.1 before
  performing the following steps.</p>
  <p>If the client implements the SMB 3.1.1 dialect and
  ProtocolId in the header of the received message is 0x424D53FC, the client
  MUST decompress the request as specified in section 3.2.5.1.10 before performing
  the following steps.</p>
  <p>If ProtocolId in the header of the received message is
  0x424D53FE, the client MUST perform the following:</p>
  <p>Unless specifically noted in a subsequent section, the
  following logic MUST be applied to any response message that is received from
  the server by the client. If the status code in the SMB2 header is not equal
  to STATUS_SUCCESS, the client SHOULD&lt;143&gt; retry the operation, in an
  implementation-specific manner, on the same or different channel. The client
  MUST ignore the CreditCharge field in the SMB2 header.</p>
  <p>If the message size received exceeds
  Connection.MaxTransactSize, the client MUST disconnect the connection.</p>
  <p>Otherwise the client MUST disconnect the connection.</p>
  <p> </p>
  <p>In Sections 3.2.5.1.1, Decrypting the Message, and
  3.2.5.1.10, Decompressing the Message, all instances of
  &quot;0x424d53FE&quot; have been changed to &quot;0x424D53FE&quot;</p>
  <p> </p>
  <p>In Section 3.3.5.2, Receiving Any Message, the
  following has been changed from:</p>
  <p> </p>
  <p>If the server implements the SMB 3.x dialect family,
  and the ProtocolId in the header of the received message is 0x424d53FD, the
  server MUST decrypt the message as specified in section 3.3.5.2.1 before
  performing the following steps. </p>
  <p>If the server supports compression and the ProtocolId
  in the header of the received message is 0x424d53FC, the server MUST
  decompress the message as specified in section 3.3.5.2.13 before performing
  the following steps.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If ProtocolId in the header of the received message is
  0x424D53FF and the command received is SMB_COM_NEGOTIATE, the client MUST
  process the request as specified in section 3.3.5.3.</p>
  <p>If the server implements the SMB 3.x dialect family,
  and the ProtocolId in the header of the received message is 0x424D53FD, the
  server MUST decrypt the message as specified in section 3.3.5.2.1 before
  performing the following steps. </p>
  <p>If the server supports compression and the ProtocolId
  in the header of the received message is 0x424D53FC, the server MUST
  decompress the message as specified in section 3.3.5.2.13 before performing
  the following steps.</p>
  <p>If ProtocolId in the header of the received message is
  0x424D53FE, the server MUST perform the following:</p>
  <p> </p>
  <p>...</p>
  <p> </p>
  <p>Otherwise, the server MUST disconnect the connection.</p>
  <p> </p>
  <p>In Section 3.3.5.2.1, Decrypting the Message,
  &quot;0x424d53FC&quot; has been changed to &quot;0x424D53FC&quot; and
  &quot;0x424d53FE&quot; has been changed to &quot;0x424D53FE&quot;</p>
  <p> </p>
  <p>In Section 3.3.5.2.6, Handling Incorrectly Formatted
  Requests, the following has been removed:</p>
  <p> </p>
  <p>The ProtocolId field in the SMB2 header is not equal
  to 0xFE, 'S', 'M', and 'B' (in network order).</p>
  <p> </p>
  <p>In Section 3.3.5.2.13, Decompressing the message,
  &quot;0x424d53FE&quot; has been changed to &quot;0x424D53FE&quot;</p>
  <p> </p>
  <p>In Section 3.3.5.3, Receiving an SMB_COM_NEGOTIATE,
  the following has been changed from:</p>
  <p> </p>
  <p>If the request does not have a valid SMB2 header
  following the syntax specified in section 2.2.1, the server MUST check to see
  if it has received an SMB_COM_NEGOTIATE as described in section 1.7.</p>
  <p>This request is defined in [MS-SMB] section 2.2.4.5.1,
  with the SMB header defined in section 2.2.3.1. If the request matches the
  format described there, and Connection.NegotiateDialect is 0xFFFF, processing
  MUST continue as specified in 3.3.5.3.1. Otherwise, the server MUST
  disconnect the connection, as specified in section 3.3.7.1, without sending a
  response.</p>
  <p> </p>
  <p>Changed to:</p>
  <p> </p>
  <p>If Connection.NegotiateDialect is 0xFFFF, processing
  MUST continue as specified in 3.3.5.3.1. Otherwise, the server MUST
  disconnect the connection, as specified in section 3.3.7.1, without sending a
  response.</p>
  <p> </p>
  <p>For details on the above changes, see the PDF doc <span><a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SMB2/%5bMS-SMB2%5d_190429_errata_diff.pdf">here</a></span>.</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/04/15</p>
  </td>
  <td>
  <p>In two sections, the logic for checking against
  Dialect and Channel has been modified.</p>
  <p> </p>
  <p>In Section 3.3.5.12, Receiving an SMB2 READ Request,
  the following has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>Connection.Dialect is &quot;3.0.2&quot; or
  &quot;3.1.1&quot; and Channel is not equal to SMB2_CHANNEL_RDMA_V1 or
  SMB2_CHANNEL_NONE.&#8203;</p>
  <p>Connection.Dialect is &quot;3.0&quot; and Channel is
  not equal to SMB2_CHANNEL_RDMA_V1_INVALIDATE. &#8203;</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>Connection.Dialect is &quot;3.0.2&quot; or
  &quot;3.1.1&quot; and Channel is not equal to SMB2_CHANNEL_RDMA_V1_INVALIDATE
  or SMB2_CHANNEL_RDMA_V1 or SMB2_CHANNEL_NONE.&#8203;</p>
  <p>Connection.Dialect is &quot;3.0&quot; and Channel is
  not equal to SMB2_CHANNEL_RDMA_V1 or SMB2_CHANNEL_NONE. &#8203;</p>
  <p>&#8203;</p>
  <p>In Section 3.3.5.13, Receiving an SMB2 WRITE Request,
  the following has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>Connection.Dialect is &quot;3.0.2&quot; or
  &quot;3.1.1&quot; and Channel is not equal to SMB2_CHANNEL_RDMA_V1 or
  SMB2_CHANNEL_NONE.&#8203;</p>
  <p>Connection.Dialect is &quot;3.0&quot; and Channel is
  not equal to SMB2_CHANNEL_RDMA_V1_INVALIDATE. &#8203;</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>Connection.Dialect is &quot;3.0.2&quot; or
  &quot;3.1.1&quot; and Channel is not equal to SMB2_CHANNEL_RDMA_V1_INVALIDATE
  or SMB2_CHANNEL_RDMA_V1 or SMB2_CHANNEL_NONE.&#8203;</p>
  <p>Connection.Dialect is &quot;3.0&quot; and Channel is
  not equal to SMB2_CHANNEL_RDMA_V1 or SMB2_CHANNEL_NONE.</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/04/15</p>
  </td>
  <td>
  <p>In Section 2.2.31.1, SRV_COPYCHUNK_COPY, the first
  paragraph has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The SRV_COPYCHUNK_COPY packet is sent in an SMB2 IOCTL
  Request by the  client to initiate a server-side copy of data. It is set as
  the contents of the input data buffer. This packet consists of the
  following:&#8203;</p>
  <p>…</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>The SRV_COPYCHUNK_COPY packet is sent to the server in
  an SMB2 IOCTL Request using FSCTL_SRV_COPYCHUNK or FSCTL_SRV_COPYCHUNK_WRITE
  by the  client to initiate a server-side copy of data. It is set as the
  contents of the input data buffer. This packet consists of the
  following:&#8203;</p>
  <p>…</p>
  <p>&#8203;</p>
  <p>In Section 2.2.32.1, SRV_COPYCHUNK_RESPONSE, the first
  paragraph has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The SRV_COPYCHUNK_RESPONSE packet is sent in an SMB2
  IOCTL Response by the server to return the results of a server-side copy
  operation . It is placed in the Buffer field of the SMB2 IOCTL Response
  packet. This packet consists of the following:&#8203;</p>
  <p>…</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>The SRV_COPYCHUNK_RESPONSE packet is sent to the
  client by the server in an SMB2 IOCTL Response for FSCTL_SRV_COPYCHUNK or
  FSCTL_SRV_COPYCHUNK_WRITE requests to return the results of a server-side
  copy operation . It is placed in the Buffer field of the SMB2 IOCTL Response
  packet. This packet consists of the following:</p>
  <p>…</p>
  </td>
 </tr><tr>
  <td>
  <p>2019/04/15</p>
  </td>
  <td>
  <p>Several sections have been updated to modify
  information about an input buffer. </p>
  <p>In Section 2.2.31, SMB2 IOCTL Request, the InputOffset
  field has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>InputOffset (4 bytes): The offset, in bytes, from the
  beginning of the SMB2 header to the input data buffer. If no input data is
  required for the FSCTL/IOCTL command being issued, the client SHOULD set this
  value to 0.&lt;57&gt; &#8203;</p>
  <p>&lt;57&gt; Section 2.2.31: If no input data is
  required for the FSCTL/IOCTL command being issued, Windows-based clients set
  this field to any value.&#8203;</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>InputOffset (4 bytes): The offset, in bytes, from the
  beginning of the SMB2 header to the input data buffer. If no input data is
  required for the FSCTL/IOCTL command being issued, this field can be set to
  any value by the client and MUST be ignored by the server. &#8203;</p>
  <p>&#8203;</p>
  <p>In Section 3.2.4.20.1, Application Requests
  Enumeration of Previous Versions, the following has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  follows:&#8203;</p>
  <p>&#9679; The CtlCode field is set to
  FSCTL_SRV_ENUMERATE_SNAPSHOTS.&#8203;</p>
  <p>&#9679; The FileId field is set to Open.FileId.&#8203;</p>
  <p>&#9679; The InputOffset field SHOULD&lt;131&gt; be set
  to 0.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The OutputOffset field SHOULD&lt;132&gt; be
  set to zero.&#8203;</p>
  <p>&#9679; The OutputCount field is set to 0.&#8203;</p>
  <p>&#9679; The MaxInputResponse field is set to 0.&#8203;</p>
  <p>…</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  specified in section 2.2.31, with the exception of the following
  values:&#8203;</p>
  <p>&#9679; The CtlCode field is set to
  FSCTL_SRV_ENUMERATE_SNAPSHOTS.&#8203;</p>
  <p>&#9679; The FileId field is set to Open.FileId.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The MaxInputResponse field is set to 0.</p>
  <p>…&#8203;</p>
  <p>&#8203;</p>
  <p>In Section 3.2.4.20.2.1, Application Requests a Source
  File Key, the following has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  follows:&#8203;</p>
  <p>&#9679; The CtlCode field is set to the
  FSCTL_SRV_REQUEST_RESUME_KEY.&#8203;</p>
  <p>&#9679; The FileId field is set to Open.FileId.&#8203;</p>
  <p>&#9679; The InputOffset field SHOULD&lt;133&gt; be set
  to 0.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The OutputOffset field SHOULD&lt;134&gt; be
  set to 0.&#8203;</p>
  <p>&#9679; The OutputCount field is set to 0. </p>
  <p>…&#8203;</p>
  <p>&#8203;</p>
  <p>Changed to&#8203;:</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  specified in section 2.2.31, with the exception of the following
  values:&#8203;</p>
  <p>&#9679; The CtlCode field is set to the
  FSCTL_SRV_REQUEST_RESUME_KEY.&#8203;</p>
  <p>&#9679; The FileId field is set to Open.FileId.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The OutputOffset field SHOULD&lt;134&gt; be
  set to 0.&#8203;</p>
  <p>…</p>
  <p>&#8203;</p>
  <p>&#8203;</p>
  <p>In Section 3.2.4.20.5, Application Requests a Peek at
  Pipe Data, the following has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  follows:&#8203;</p>
  <p>&#9679; The CtlCode field is set to
  FSCTL_PIPE_PEEK.&#8203;</p>
  <p>&#9679; The FileId field is set to Open.FileId.&#8203;</p>
  <p>&#9679; The InputOffset field SHOULD&lt;139&gt; be set
  to 0.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The OutputOffset field SHOULD&lt;140&gt; be
  set to zero.&#8203;</p>
  <p>&#9679; The OutputCount field is set to 0.&#8203;</p>
  <p>…</p>
  <p>&#8203;</p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  specified in section 2.2.31, with the exception of the following
  values:&#8203;</p>
  <p>&#9679; The CtlCode field is set to
  FSCTL_PIPE_PEEK.&#8203;</p>
  <p>&#9679; The FileId field is set to Open.FileId.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The OutputOffset field SHOULD&lt;140&gt; be
  set to zero.&#8203;</p>
  <p>&#8203;…</p>
  <p>&#8203;</p>
  <p>In Section 3.2.4.20.10, Application Requests Querying
  Server's Network Interfaces, has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  specified in section 2.2.31, with the exception of the following
  values:&#8203;</p>
  <p>&#9679; The CtlCode field is set to FSCTL_QUERY_NETWORK_INTERFACE_INFO.&#8203;</p>
  <p>&#9679; The FileId field is set to {
  0xFFFFFFFFFFFFFFFF, 0xFFFFFFFFFFFFFFFF }.&#8203;</p>
  <p>&#9679; The MaxInputResponse field is set to 0.&#8203;</p>
  <p>&#9679; The MaxOutputResponse field is set to an
  implementation-specific&lt;145&gt; value. &#8203;</p>
  <p>&#9679; SMB2_0_IOCTL_IS_FSCTL is set to TRUE in the
  Flags field.&#8203;</p>
  <p>&#9679; The InputOffset field is set to the offset to
  the Buffer, in bytes, from the beginning of the SMB2 header.&#8203;</p>
  <p>&#8203;…</p>
  <p> </p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>The SMB2 IOCTL Request MUST be initialized as
  specified in section 2.2.31, with the exception of the following
  values:&#8203;</p>
  <p>&#9679; The CtlCode field is set to
  FSCTL_QUERY_NETWORK_INTERFACE_INFO.&#8203;</p>
  <p>&#9679; The FileId field is set to {
  0xFFFFFFFFFFFFFFFF, 0xFFFFFFFFFFFFFFFF }.&#8203;</p>
  <p>&#9679; The InputCount field is set to 0.&#8203;</p>
  <p>&#9679; The MaxInputResponse field is set to 0.&#8203;</p>
  <p>&#9679; The MaxOutputResponse field is set to an
  implementation-specific&lt;145&gt; value. &#8203;</p>
  <p>&#9679; SMB2_0_IOCTL_IS_FSCTL is set to TRUE in the
  Flags field.&#8203;</p>
  <p>&#8203;…</p>
  <p> </p>
  <p>In Section 3.3.5.15, Receiving an SMB2 IOCTL Request,
  the following has been changed from:&#8203;</p>
  <p>&#8203;</p>
  <p>The server MUST fail the request with
  STATUS_INVALID_PARAMETER in the following cases:&#8203;</p>
  <p>&#8203;…</p>
  <p> </p>
  <p>Changed to:&#8203;</p>
  <p>&#8203;</p>
  <p>If InputCount is not equal to zero, the server MUST
  fail the request with STATUS_INVALID_PARAMETER in the following cases:</p>
  <p>…</p>
  </td>
 </tr></tbody></table>

<p>*Date format: YYYY/MM/DD</p>


                